<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2023-05-31 Wed 11:49 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>General Self-Consistent Field Methods</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Vijay Gopal Chilkuri" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2020 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">General Self-Consistent Field Methods</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org8b8ad5d">1. Introduction</a></li>
<li><a href="#orga9d9401">2. Hydrogen atom</a>
<ul>
<li><a href="#org4747f1c">2.1. Methodology</a>
<ul>
<li><a href="#org11af05d">2.1.1. Shooting method</a></li>
<li><a href="#org9dab6f8">2.1.2. Code</a></li>
<li><a href="#org44a3b60">2.1.3. Plot</a></li>
<li><a href="#org7dccd3d">2.1.4. Main</a></li>
<li><a href="#org23cb64d">2.1.5. Solution of the SLP</a></li>
<li><a href="#orgfc77534">2.1.6. Code</a></li>
<li><a href="#org0f071fa">2.1.7. Testing</a></li>
<li><a href="#orgbd16121">2.1.8. Main</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgd1c5d59">3. Helium atom</a>
<ul>
<li><a href="#org5f70f2f">3.1. Poisson equation</a></li>
<li><a href="#orgd8cd354">3.2. Solution</a>
<ul>
<li><a href="#org7548b0b">3.2.1. Vector Field</a></li>
<li><a href="#org4024f21">3.2.2. Testing</a></li>
<li><a href="#org8214e7f">3.2.3. Main</a></li>
</ul>
</li>
<li><a href="#org9f11e94">3.3. Self-consistent field cycle</a>
<ul>
<li><a href="#orge5d7170">3.3.1. Vector Field</a></li>
<li><a href="#orga9fe277">3.3.2. Calculate energy</a></li>
<li><a href="#org7cc8504">3.3.3. SCF cycle code</a></li>
<li><a href="#org2a1405b">3.3.4. Main</a></li>
</ul>
</li>
<li><a href="#orgb6706d9">3.4. Figure</a></li>
<li><a href="#orgee47255">3.5. The local density Exchange potential</a>
<ul>
<li><a href="#org1da8a83">3.5.1. Vector Field</a></li>
<li><a href="#org800006f">3.5.2. Calculate energy</a></li>
<li><a href="#org9a5e378">3.5.3. SCF cycle code</a></li>
<li><a href="#org4f89843">3.5.4. Main Shoot</a></li>
<li><a href="#org6227cc0">3.5.5. Main</a></li>
</ul>
</li>
<li><a href="#orgba1c1d0">3.6. Figure</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org8b8ad5d" class="outline-2">
<h2 id="org8b8ad5d"><span class="section-number-2">1</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
The Schrodinger equation is a certain class of Boundary Value Problem (BVP).
Solution of the Schrodinger equation results in the eigenvalues(\(\lambda\)) and
eigenvectors (\(\psi\)) of the Hamiltonian.
</p>

<p>
\[
\mathcal{L}\psi(x) = \lambda\psi(x)
\]
</p>

<p>
These type of equations where \(\mathcal{L}\) is a second order differential
operator and self-adjoint (i.e. hermitian) is called a Sturm-Liouville problem (SLP).
Sturm-Liouville problems are general eigenvalues problems of the form
</p>

<p>
\[
-\frac{d}{dt}\left ( p(t) \frac{d y(t)}{dt} \right ) + q(t)y(t) = \lambda g(t)y(t)
\]
</p>

<p>
posed on an interval \(-\infty \le a \le b \le \infty\) which may be finite or infinite. Such
problem's arise in various fields of physics and chemistry and there exist
robust and well studied numerical and analytical methods for their resolution.
</p>

<p>
In the present manuscript, we shall document numerical methods for the solution
of various types of Hamiltonians and analyze their spectra and wavefunctions.
</p>
</div>
</div>

<div id="outline-container-orga9d9401" class="outline-2">
<h2 id="orga9d9401"><span class="section-number-2">2</span> Hydrogen atom</h2>
<div class="outline-text-2" id="text-2">
<p>
We begin with the most simplest SLP which is the solution
of the Hamiltonian for the hydrogen atom Eq:<a href="#org2cfcbd3">1</a>
</p>

<p>
\[
\hat{H}\psi(\mathbf{x}) = \left [ -\frac{1}{2}\bigtriangleup + V \right ]\psi(\mathbf{x})
\]
</p>

<p>
This is the SLP(Eq:<a href="#orgc8fb110">1</a>) with \(p(t)=\frac{1}{2}\), and \(g(t)=1\), and \(q(t)=V\), the potential acting
on the particle. The Eq:<a href="#org2cfcbd3">1</a> is in cartesian coordinates \(\mathbf{x}\) and
can be transformed to spherical coordinates via a coordinate transformation.
</p>

<p>
\[
x_1 = r\sin{\theta}\cos{\phi}
\]
\[
x_2 = r\sin{\theta}\sin{\phi}
\]
\[
x_3 = r\cos{\theta}
\]
</p>

<p>
In spherical coordinates, the operator \(\hat{H}\) is transformed to
</p>

<p>
\[
\hat{H} = -\frac{1}{2}\frac{1}{r^2}\frac{\partial}{\partial r} \left( r^2 \frac{\partial}{\partial r} \right)
\]
\[
   -\frac{1}{r^2}\frac{1}{\sin{\theta}}\frac{\partial}{\partial\theta} \left(\sin{\theta}\frac{\partial}{\partial\theta} \right)
\]
\[
   -\frac{1}{r^2}\frac{1}{\sin{\theta}^2}\frac{\partial^2}{\partial\phi^2} + V
\]
</p>

<p>
We can then separate the wavefunction to three independent variables
\(\psi(\mathbf{x})=R(r)\Theta(\theta)\Phi(\phi)\) to obtain three separate SLPs
</p>

<p>
\[
\left (
-\frac{1}{2}\frac{1}{r^2}\frac{\partial}{\partial r} \left( r^2 \frac{\partial}{\partial r} \right) + \frac{l(l+1)}{r^2} + V(r) \right)R(r) = \lambda R(r)
\]
</p>

<p>
\[
\frac{1}{\sin{\theta}}\left (-\frac{\partial}{\partial \theta} \left( \sin{\theta} \frac{\partial}{\partial \theta} \right)+ \frac{m^2}{\sin{\theta}} \right)\Theta(\theta) = l(l+1)
\]
\[
\Theta(\theta)-\frac{\partial^2}{\partial \phi^2}\Phi(\phi) = m^2 \Phi(\phi)
\]
</p>

<p>
With only \(r\) being the dependent variable i.e. the first equation.
Here we can do a further transformation of the dependent variable
\(u(r) = r R(r)\) which gives the SLP
</p>

<p>
\[
-\frac{1}{2}\frac{\partial^2 u(r)}{\partial r^2}+ q(r) u(r) = \lambda u(r)
\]
\[
q(r) = \frac{l(l+1)}{r^2} + V(r)
\]
\[
p(r) = g(r) = 1
\]
</p>

<p>
These (Eq:<a href="#orgf14774f">1</a>) are the working equations.
</p>
</div>

<div id="outline-container-org4747f1c" class="outline-3">
<h3 id="org4747f1c"><span class="section-number-3">2.1</span> Methodology</h3>
<div class="outline-text-3" id="text-2-1">
<p>
First, we transfrom Eq:<a href="#orgf14774f">1</a> into a set of coupled linear
ODEs
</p>

<p>
\[
y = \begin{pmatrix} u \\ u' \end{pmatrix}
\]
\[
y' = \begin{pmatrix} u' \\ u'' \end{pmatrix} = \begin{pmatrix} u' \\ 2\left( \frac{l(l+1)}{r^2} -\frac{\mathcal{Z}}{r} - E \right) u \end{pmatrix}
\]
</p>

<p>
The boundary conditions are at \(r=0\) and \(r=\infty\) with
\(u(r)=0\) and \(u(\infty)=0\).
</p>
</div>

<ol class="org-ol">
<li><a id="orgf7f1952"></a>Vector Field<br />
<div class="outline-text-5" id="text-2-1-0-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> numpy <span style="color: #a020f0;">as</span> np
<span style="color: #a020f0;">from</span> scipy.integrate <span style="color: #a020f0;">import</span> odeint
<span style="color: #a020f0;">from</span> scipy <span style="color: #a020f0;">import</span> integrate
<span style="color: #a020f0;">from</span> scipy <span style="color: #a020f0;">import</span> interpolate
<span style="color: #a020f0;">from</span> scipy.optimize <span style="color: #a020f0;">import</span> root_scalar
<span style="color: #a020f0;">import</span> matplotlib.pyplot <span style="color: #a020f0;">as</span> plt
<span style="color: #a020f0;">from</span> copy <span style="color: #a020f0;">import</span> deepcopy

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">vectorfield</span>(w, t, p):
    <span style="color: #8b2252;">"""</span>
<span style="color: #8b2252;">    Defines the differential equations for the coupled spring-mass system.</span>

<span style="color: #8b2252;">    Arguments:</span>
<span style="color: #8b2252;">    w :  vector of the state variables:</span>
<span style="color: #8b2252;">              w = [x1,y1,x2,y2]</span>
<span style="color: #8b2252;">    t :  time</span>
<span style="color: #8b2252;">    p :  vector of the parameters:</span>
<span style="color: #8b2252;">              p = [m1,m2,k1,k2,L1,L2,b1,b2]</span>
<span style="color: #8b2252;">    """</span>
    <span style="color: #a0522d;">x1</span>, <span style="color: #a0522d;">y1</span> = w
    <span style="color: #a0522d;">e1</span>, <span style="color: #a0522d;">l1</span>, <span style="color: #a0522d;">urf</span>, <span style="color: #a0522d;">tckur</span>, <span style="color: #a0522d;">_</span>, <span style="color: #a0522d;">_</span>, <span style="color: #a0522d;">_</span>, <span style="color: #a0522d;">_</span>, <span style="color: #a0522d;">z</span> = p

    # <span style="color: #b22222;">Create f = (x1',y1'):</span>
    <span style="color: #a0522d;">f</span> = [y1,
         2*(l1*(l1+1)/(t)**2 - z/(t) - e1 + urf(t,tckur)/t)*x1
         ]

    <span style="color: #a020f0;">return</span> f
</pre>
</div>
</div>
</li>
<li><a id="org8b65607"></a>Solution<br />
<div class="outline-text-5" id="text-2-1-0-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">solve_SLP</span>(fn=<span style="color: #008b8b;">None</span>, tckfn=<span style="color: #008b8b;">None</span>, fnx=<span style="color: #008b8b;">None</span>, tckfnx=<span style="color: #008b8b;">None</span>, fnc=<span style="color: #008b8b;">None</span>, tckfnc=<span style="color: #008b8b;">None</span>, e1=-0.5, l1=0, z=1., t=<span style="color: #008b8b;">None</span>, numpoints=1600, stoptime=15.0, xlim=0, ylim=-1.0E-6, vectorfield=<span style="color: #008b8b;">None</span>, isWF=<span style="color: #008b8b;">True</span>):

    <span style="color: #a020f0;">if</span> fn <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>:
        <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fn</span>(x,tckfn):
            <span style="color: #a020f0;">return</span>(0.)

    <span style="color: #a020f0;">if</span> fnx <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>:
        <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fnx</span>(x,tckfnx):
            <span style="color: #a020f0;">return</span>(0.)

    <span style="color: #a020f0;">if</span> fnc <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>:
        <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fnc</span>(x,tckfnc):
            <span style="color: #a020f0;">return</span>(0.)

    <span style="color: #a020f0;">if</span> vectorfield <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>:
        <span style="color: #a020f0;">print</span>(<span style="color: #8b2252;">"[solve_SLP] Error: Have to supply a vectorfield"</span>)
        <span style="color: #a020f0;">return</span>(0,0,0)

    # <span style="color: #b22222;">Parameter values</span>
    # <span style="color: #b22222;">Initial conditions</span>
    # <span style="color: #b22222;">x1 and x2 are the initial displacements; y1 and y2 are the initial velocities</span>
    <span style="color: #a0522d;">x1</span> = xlim
    <span style="color: #a0522d;">y1</span> = ylim

    # <span style="color: #b22222;">ODE solver parameters</span>
    <span style="color: #a0522d;">abserr</span> = 1.0e-8
    <span style="color: #a0522d;">relerr</span> = 1.0e-6

    # <span style="color: #b22222;">Create the time samples for the output of the ODE solver.</span>
    # <span style="color: #b22222;">I use a large number of points, only because I want to make</span>
    # <span style="color: #b22222;">a plot of the solution that looks nice.</span>
    <span style="color: #a020f0;">if</span> t <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>:
        <span style="color: #a0522d;">t</span> = [stoptime * <span style="color: #483d8b;">float</span>(i+0.0001) / (numpoints - 1) <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(numpoints)]

    # <span style="color: #b22222;">Reverse the list to converge from the right</span>
    <span style="color: #a0522d;">t_rev</span> = t[::-1]

    # <span style="color: #b22222;">Pack up the parameters and initial conditions:</span>
    <span style="color: #a0522d;">p</span> = [e1, l1, fn, tckfn, fnx, tckfnx, fnc, tckfnc, z]
    <span style="color: #a0522d;">w0</span> = [x1, y1]

    # <span style="color: #b22222;">Call the ODE solver.</span>
    <span style="color: #a0522d;">wsol</span> = odeint(vectorfield, w0, t_rev, args=(p,),
                  atol=abserr, rtol=relerr)

    <span style="color: #a0522d;">x1</span> = wsol[:,0]

    # <span style="color: #b22222;">Reverse the result back</span>
    <span style="color: #a0522d;">x1</span> = x1[::-1]

    <span style="color: #a020f0;">if</span> isWF:
        # <span style="color: #b22222;">Normalize wavefunction</span>
        <span style="color: #a0522d;">norm</span> = integrate.simps(x1**2, x=t)
        <span style="color: #a0522d;">x1</span> = x1/np.sqrt(norm)

    <span style="color: #a0522d;">tckfnout</span> = interpolate.splrep(t,x1)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fnout</span>(x, tck):
        <span style="color: #a020f0;">return</span> interpolate.splev(x, tckfnout)
    <span style="color: #a020f0;">return</span>(x1,fnout,tckfnout)
</pre>
</div>
</div>
</li>
</ol>

<div id="outline-container-org11af05d" class="outline-4">
<h4 id="org11af05d"><span class="section-number-4">2.1.1</span> Shooting method</h4>
<div class="outline-text-4" id="text-2-1-1">
<p>
Here we start with \(u(\infty)=0\) and integrate towards
\(r=0\). This is more stable for the convergence with
respect to the Hydrogen atom.
</p>
</div>
</div>

<div id="outline-container-org9dab6f8" class="outline-4">
<h4 id="org9dab6f8"><span class="section-number-4">2.1.2</span> Code</h4>
<div class="outline-text-4" id="text-2-1-2">
<p>
Main function that does the shooting.
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">shoot</span>(E, t, l=0, z=1., fn=<span style="color: #008b8b;">None</span>, tckfn=<span style="color: #008b8b;">None</span>, fnx=<span style="color: #008b8b;">None</span>, tckfnx=<span style="color: #008b8b;">None</span>, fnc=<span style="color: #008b8b;">None</span>, tckfnc=<span style="color: #008b8b;">None</span>, xlim=0, ylim=-1.E-6, vectorfield=<span style="color: #008b8b;">None</span>, isWF=<span style="color: #008b8b;">True</span>):
   <span style="color: #a020f0;">if</span> vectorfield <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>:
      <span style="color: #a020f0;">print</span>(<span style="color: #8b2252;">"[shoot] Error: Have to supply a vectorfield"</span>)
      <span style="color: #a020f0;">return</span>(0,0,0,0)
   <span style="color: #a0522d;">u</span>,<span style="color: #a0522d;">fnout</span>,<span style="color: #a0522d;">tckfnout</span>= solve_SLP(fn=fn, tckfn=<span style="color: #008b8b;">None</span>, fnx=fnx, tckfnx=tckfnx, fnc=fnc, tckfnc=tckfnc, e1=E, l1=l, z=z, t=t, xlim=xlim, ylim=ylim, vectorfield=vectorfield, isWF=isWF)
   <span style="color: #a0522d;">u</span> = u/t**l

   # <span style="color: #b22222;">Extrapolate u to the origin r=0.</span>
   <span style="color: #a020f0;">return</span> u[0] - t[0] * (u[1] - u[0])/(t[1] - t[0]), u, fnout, tckfnout
</pre>
</div>
</div>
</div>

<div id="outline-container-org44a3b60" class="outline-4">
<h4 id="org44a3b60"><span class="section-number-4">2.1.3</span> Plot</h4>
<div class="outline-text-4" id="text-2-1-3">
<p>
Plot to check results.
</p>

<div class="figure">
<p><img src="./Figs/Fig-1.png" alt="Fig-1.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org7dccd3d" class="outline-4">
<h4 id="org7dccd3d"><span class="section-number-4">2.1.4</span> Main</h4>
<div class="outline-text-4" id="text-2-1-4">
<p>
Make some figures.
</p>

<div class="figure">
<p><img src="./Figs/Fig-2.png" alt="Fig-2.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org23cb64d" class="outline-4">
<h4 id="org23cb64d"><span class="section-number-4">2.1.5</span> Solution of the SLP</h4>
<div class="outline-text-4" id="text-2-1-5">
<p>
Here we have to search for the value of \(E\)
for which the BVP has the final conditions satisfied
i.e. \(u(r)=0\). This is done using the optimization
routine from <code>scipy</code>.
</p>
</div>
</div>

<div id="outline-container-orgfc77534" class="outline-4">
<h4 id="orgfc77534"><span class="section-number-4">2.1.6</span> Code</h4>
<div class="outline-text-4" id="text-2-1-6">
<p>
The code is as follows
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_energy_and_density</span>(l,rr,z=1.,E=<span style="color: #008b8b;">None</span>, vectorfield=<span style="color: #008b8b;">None</span>, urf=<span style="color: #008b8b;">None</span>, tckur=<span style="color: #008b8b;">None</span>, fnx=<span style="color: #008b8b;">None</span>, tckfnx=<span style="color: #008b8b;">None</span>, fnc=<span style="color: #008b8b;">None</span>, tckfnc=<span style="color: #008b8b;">None</span>, xlim=0., ylim=-1.0E-6, isWF=<span style="color: #008b8b;">True</span>):
    <span style="color: #a0522d;">dE</span> = 0.51 # <span style="color: #b22222;">scan resolution to look for sign changes</span>
    <span style="color: #a020f0;">if</span> E <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>:
        <span style="color: #a0522d;">E</span> = -1.0 # <span style="color: #b22222;">starting energy</span>

    <span style="color: #a020f0;">if</span> vectorfield <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>:
        <span style="color: #a020f0;">print</span>(<span style="color: #8b2252;">"[get_energy_and_density] Error have to supply a vectorfield"</span>)
        <span style="color: #a020f0;">return</span>(0)

    <span style="color: #a020f0;">if</span> urf <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>:
        <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">urf</span>(x,tckur):
            <span style="color: #a020f0;">return</span>(0)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fn</span>(e):
        <span style="color: #a0522d;">u0s</span> = shoot(e, rr, l=l, z=z, fn=urf, tckfn=tckur, fnx=fnx, tckfnx=tckfnx, fnc=fnc, tckfnc=tckfnc, vectorfield=vectorfield, xlim=xlim, ylim=ylim, isWF=isWF)[0]
        <span style="color: #a020f0;">return</span>(u0s)
    <span style="color: #a0522d;">E_bound</span> = root_scalar(fn, x0=E-dE, x1=E+dE).root
    <span style="color: #a0522d;">_</span>,<span style="color: #a0522d;">u_bound</span>,<span style="color: #a0522d;">nrf</span>,<span style="color: #a0522d;">tck</span> = shoot(E_bound, rr, l=l, z=z, fn=urf, fnx=fnx, tckfnx=tckfnx, fnc=fnc, tckfnc=tckfnc, tckfn=tckur, vectorfield=vectorfield, xlim=xlim, ylim=ylim, isWF=isWF)
    <span style="color: #a020f0;">return</span>(E_bound, u_bound, nrf, tck)
</pre>
</div>
</div>
</div>
<div id="outline-container-org0f071fa" class="outline-4">
<h4 id="org0f071fa"><span class="section-number-4">2.1.7</span> Testing</h4>
<div class="outline-text-4" id="text-2-1-7">
<p>
Test the functions.
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> sys
# <span style="color: #b22222;">the mock-0.3.1 dir contains testcase.py, testutils.py &amp; mock.py</span>
sys.path.append(<span style="color: #8b2252;">'/home/runner/work/gscf/gscf/src'</span>)
sys.path.append(<span style="color: #8b2252;">'/home/runner/work/gscf/gscf'</span>)

<span style="color: #a020f0;">import</span> numpy <span style="color: #a020f0;">as</span> np

<span style="color: #a020f0;">from</span> src.hydrogen <span style="color: #a020f0;">import</span> get_energy_and_density, vectorfield

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">test_hydrogen</span>(numpoints=3200, stoptime=60):
    <span style="color: #a0522d;">rr</span> = np.array([stoptime * <span style="color: #483d8b;">float</span>(i+0.0001) / (numpoints - 1) <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(numpoints)])
    <span style="color: #a0522d;">E_bound</span>,<span style="color: #a0522d;">_</span>,<span style="color: #a0522d;">_</span>,<span style="color: #a0522d;">_</span> = get_energy_and_density(0,rr,vectorfield=vectorfield)
    <span style="color: #483d8b;">abs</span>(E_bound - 0.5) &lt;= 1.0E-10
</pre>
</div>
</div>
</div>
<div id="outline-container-orgbd16121" class="outline-4">
<h4 id="orgbd16121"><span class="section-number-4">2.1.8</span> Main</h4>
<div class="outline-text-4" id="text-2-1-8">
<p>
Make figures.
</p>

<div class="figure">
<p><img src="./Figs/Fig-3.png" alt="Fig-3.png" />
</p>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd1c5d59" class="outline-2">
<h2 id="orgd1c5d59"><span class="section-number-2">3</span> Helium atom</h2>
<div class="outline-text-2" id="text-3">
<p>
Here we need to include the Hartree potential \(V_H\) which is the
repulsion between the two electrons
</p>

<p>
\[
V_H(\mathbf{r}) = \int dr'^3 n(\mathbf{r}')\frac{1}{\mathbf{r}-\mathbf{r}'}
\]
</p>

<p>
Where the \(n(\mathbf{r})\) is the density which is given as
</p>

<p>
\[
n(\mathbf{r}) = 2\sum_i^{N_{occ}} |\psi(\mathbf{r})|^2
\]
</p>

<p>
where we assume a closed shell spin singlet slater determinant.
In order to get the radial part of the density, we can use the
radial part of the wavefunction \(\psi(\mathbf{r})\) which is \(R(\mathbf{r})\).
</p>

\begin{align*}
n(r) &= 2\sum_i^{N_{occ}} |R(r)|^2 \\
n(r) &= 2\sum_i^{N_{occ}} \left |\frac{u(r)}{r}\right|^2 \\
\end{align*}
</div>


<div id="outline-container-org5f70f2f" class="outline-3">
<h3 id="org5f70f2f"><span class="section-number-3">3.1</span> Poisson equation</h3>
<div class="outline-text-3" id="text-3-1">
<p>
In order to calculate the Hartree potential Eq:<a href="#org4d6b129">1</a>, we shall
transform it into an SLP which we can again solve using the
above methodology the solution of the Hydrogen atom.
</p>

<p>
\[
\nabla^2 V_H(\mathbf{r}) = -4 \pi n(\mathbf{r})
\]
</p>

<p>
This can again be transformed using the variable substitution
\(u(r)=rR(r)\) to a 1D equation.
</p>

<p>
\[
\frac{\partial^2 U(r)}{\partial r} = -4\pi r n(r)
\]
</p>

<p>
The fact that \(n(r)\) is simply \(R(r)^2\) by definition and the
fact that \(u(r)\) is normalized we can drop off \(4\pi\) to finally
obtain
</p>

<p>
\[
U''(r) = -\frac{u(r)^2}{r}
\]
</p>

<p>
This is the SLP that we need to solve to obtain the
hartree potential \(V_H(r)\).
</p>
</div>
</div>

<div id="outline-container-orgd8cd354" class="outline-3">
<h3 id="orgd8cd354"><span class="section-number-3">3.2</span> Solution</h3>
<div class="outline-text-3" id="text-3-2">
<p>
The BVP Eq:<a href="#orgc4f223e">1</a> takes the following boundary conditions
</p>

\begin{align*}
U(0) &= 0\\
U(r_{max}) &= q_{max}
\end{align*}

<p>
where, \(q_{max}\) is the total charge. We shall use these conditions
in the shooting method to find the correct Hartree potential.
</p>

<p>
\[
q_{max} = \int_0^{max} \text{d}r\ u^2(r)
\]
</p>
</div>

<div id="outline-container-org7548b0b" class="outline-4">
<h4 id="org7548b0b"><span class="section-number-4">3.2.1</span> Vector Field</h4>
<div class="outline-text-4" id="text-3-2-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> numpy <span style="color: #a020f0;">as</span> np
<span style="color: #a020f0;">from</span> scipy.integrate <span style="color: #a020f0;">import</span> odeint
<span style="color: #a020f0;">from</span> scipy <span style="color: #a020f0;">import</span> integrate
<span style="color: #a020f0;">from</span> scipy <span style="color: #a020f0;">import</span> interpolate
<span style="color: #a020f0;">from</span> scipy.optimize <span style="color: #a020f0;">import</span> root_scalar
<span style="color: #a020f0;">import</span> matplotlib.pyplot <span style="color: #a020f0;">as</span> plt
<span style="color: #a020f0;">from</span> copy <span style="color: #a020f0;">import</span> deepcopy

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">vectorfieldVH</span>(w, t, p):
    <span style="color: #8b2252;">"""</span>
<span style="color: #8b2252;">    Defines the differential equations for the coupled spring-mass system.</span>

<span style="color: #8b2252;">    Arguments:</span>
<span style="color: #8b2252;">    w :  vector of the state variables:</span>
<span style="color: #8b2252;">              w = [x1,y1,x2,y2]</span>
<span style="color: #8b2252;">    t :  time</span>
<span style="color: #8b2252;">    p :  vector of the parameters:</span>
<span style="color: #8b2252;">              p = [m1,m2,k1,k2,L1,L2,b1,b2]</span>
<span style="color: #8b2252;">    """</span>
    <span style="color: #a0522d;">x1</span>, <span style="color: #a0522d;">y1</span> = w
    <span style="color: #a0522d;">_</span>, <span style="color: #a0522d;">_</span>, <span style="color: #a0522d;">nrf</span>, <span style="color: #a0522d;">tck</span>,<span style="color: #a0522d;">_</span>,<span style="color: #a0522d;">_</span>,<span style="color: #a0522d;">_</span>,<span style="color: #a0522d;">_</span>, <span style="color: #a0522d;">z</span> = p

    # <span style="color: #b22222;">Create f = (x1',y1'):</span>
    <span style="color: #a0522d;">f</span> = [y1,
         -nrf(t,tck)*nrf(t,tck)/t
         ]
    <span style="color: #a020f0;">return</span> f
</pre>
</div>
</div>
</div>
<div id="outline-container-org4024f21" class="outline-4">
<h4 id="org4024f21"><span class="section-number-4">3.2.2</span> Testing</h4>
<div class="outline-text-4" id="text-3-2-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">numpoints</span>=400
<span style="color: #a0522d;">stoptime</span>=15.0
<span style="color: #a0522d;">rr</span> = np.array([stoptime * <span style="color: #483d8b;">float</span>(i+0.0001) / (numpoints - 1) <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(numpoints)])
<span style="color: #a0522d;">qmax</span> = 1.
<span style="color: #a0522d;">xlim</span> = qmax
<span style="color: #a0522d;">ylim</span> = 0
<span style="color: #a0522d;">x1</span>,<span style="color: #a0522d;">urf</span>,<span style="color: #a0522d;">tckur</span> = solve_SLP(fn=nrf, tckfn=tck, t=rr, xlim=xlim, ylim=ylim, vectorfield=vectorfieldVH)
</pre>
</div>
</div>
</div>
<div id="outline-container-org8214e7f" class="outline-4">
<h4 id="org8214e7f"><span class="section-number-4">3.2.3</span> Main</h4>
<div class="outline-text-4" id="text-3-2-3">

<div class="figure">
<p><img src="./Figs/Fig-4.png" alt="Fig-4.png" />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org9f11e94" class="outline-3">
<h3 id="org9f11e94"><span class="section-number-3">3.3</span> Self-consistent field cycle</h3>
<div class="outline-text-3" id="text-3-3">
<p>
In order to find the solution, we need to perform a SCF loop
so that the energy stays constant.
</p>

<p>
In order to calculate the total energy, we now also need to
incorporate the Hartee potential
</p>

<p>
\[
E = 2 \epsilon - \int \text{d}r\ V_H(r) u^2(r)
\]
</p>
</div>


<div id="outline-container-orge5d7170" class="outline-4">
<h4 id="orge5d7170"><span class="section-number-4">3.3.1</span> Vector Field</h4>
<div class="outline-text-4" id="text-3-3-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">vectorfieldHe</span>(w, t, p):
    <span style="color: #8b2252;">"""</span>
<span style="color: #8b2252;">    Defines the differential equations for the coupled spring-mass system.</span>

<span style="color: #8b2252;">    Arguments:</span>
<span style="color: #8b2252;">    w :  vector of the state variables:</span>
<span style="color: #8b2252;">              w = [x1,y1,x2,y2]</span>
<span style="color: #8b2252;">    t :  time</span>
<span style="color: #8b2252;">    p :  vector of the parameters:</span>
<span style="color: #8b2252;">              p = [m1,m2,k1,k2,L1,L2,b1,b2]</span>
<span style="color: #8b2252;">    """</span>
    <span style="color: #a0522d;">x1</span>, <span style="color: #a0522d;">y1</span> = w
    <span style="color: #a0522d;">e1</span>, <span style="color: #a0522d;">l1</span>, <span style="color: #a0522d;">urf</span>, <span style="color: #a0522d;">tckur</span>, <span style="color: #a0522d;">z</span> = p

    # <span style="color: #b22222;">Create f = (x1',y1'):</span>
    <span style="color: #a0522d;">f</span> = [y1,
         2*(l1*(l1+1)/(t)**2 - z/t - e1 + urf(t,tckur)/t)*x1
         ]

    <span style="color: #a020f0;">return</span> f
</pre>
</div>
</div>
</div>
<div id="outline-container-orga9fe277" class="outline-4">
<h4 id="orga9fe277"><span class="section-number-4">3.3.2</span> Calculate energy</h4>
<div class="outline-text-4" id="text-3-3-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">calcEnergy</span>(ei,urf,tckur,nrf,tck,t=<span style="color: #008b8b;">None</span>,stoptime=60.0,numpoints=3200):
    <span style="color: #a0522d;">E</span> = 2*ei
    <span style="color: #a020f0;">if</span> t <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>:
        <span style="color: #a0522d;">t</span> = [stoptime * <span style="color: #483d8b;">float</span>(i+0.0001) / (numpoints - 1) <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(numpoints)]
    <span style="color: #a0522d;">h</span> = t[1]-t[0]
    <span style="color: #a0522d;">VHl</span> = np.array([urf(x,tckur)/x <span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> t])
    <span style="color: #a0522d;">Nr2</span> = np.array([(nrf(x,tck))**2 <span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> t])
    <span style="color: #a0522d;">eH</span> = integrate.simps(VHl*Nr2, x=t)
    <span style="color: #a020f0;">print</span>(eH)
    <span style="color: #a0522d;">E</span> = E - eH
    <span style="color: #a020f0;">return</span>(E)
</pre>
</div>
</div>
</div>
<div id="outline-container-org7cc8504" class="outline-4">
<h4 id="org7cc8504"><span class="section-number-4">3.3.3</span> SCF cycle code</h4>
<div class="outline-text-4" id="text-3-3-3">
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #a0522d;">stoptime</span>=60.0
<span style="color: #a0522d;">numpoints</span>=3200
<span style="color: #a0522d;">rr</span> = np.array([stoptime * <span style="color: #483d8b;">float</span>(i+0.0001) / (numpoints - 1) <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(numpoints)])

# <span style="color: #b22222;">Get initial density</span>
<span style="color: #a0522d;">E_bound</span>,<span style="color: #a0522d;">_</span>,<span style="color: #a0522d;">nrf</span>,<span style="color: #a0522d;">tck</span> = get_energy_and_density(0,rr,z=2.,E=-1.50,vectorfield=vectorfield)

# <span style="color: #b22222;">Get initial ur</span>
<span style="color: #a0522d;">qmax</span> = 1.
<span style="color: #a0522d;">xlim</span> = qmax
<span style="color: #a0522d;">ylim</span> = 0.
<span style="color: #a0522d;">x1</span>,<span style="color: #a0522d;">urf</span>,<span style="color: #a0522d;">tckur</span> = solve_SLP(fn=nrf, tckfn=tck, t=rr, xlim=xlim, ylim=ylim, vectorfield=vectorfieldVH, isWF=<span style="color: #008b8b;">False</span>)
<span style="color: #a0522d;">E0</span> = calcEnergy(E_bound, urf, tckur, nrf, tck)
<span style="color: #a020f0;">print</span>(E_bound, E0)

<span style="color: #a0522d;">E_conv</span> = []
<span style="color: #a0522d;">dE_conv</span> = []
E_conv.append(E0)
dE_conv.append(E0)
<span style="color: #a0522d;">cnt</span> = 0
<span style="color: #a0522d;">Ediff</span> = 10.
<span style="color: #a020f0;">while</span> cnt &lt; 9 <span style="color: #a020f0;">and</span> <span style="color: #483d8b;">abs</span>(Ediff) &gt; 1.E-4:

    # <span style="color: #b22222;">Get density</span>
    <span style="color: #a0522d;">E_bound</span>,<span style="color: #a0522d;">_</span>,<span style="color: #a0522d;">nrf</span>,<span style="color: #a0522d;">tck</span> = get_energy_and_density(0,rr,z=2.,E=-1.50,vectorfield=vectorfield, urf=urf, tckur=tckur)
    # <span style="color: #b22222;">Get ur</span>
    <span style="color: #a0522d;">x1</span>,<span style="color: #a0522d;">urf</span>,<span style="color: #a0522d;">tckur</span> = solve_SLP(fn=nrf, tckfn=tck, t=rr, xlim=xlim, ylim=ylim, vectorfield=vectorfieldVH, isWF=<span style="color: #008b8b;">False</span>)
    <span style="color: #a0522d;">E1</span> = calcEnergy(E_bound, urf, tckur, nrf, tck,t=rr)
    #<span style="color: #b22222;">E1 = E_bound</span>
    E_conv.append(E1)
    <span style="color: #a0522d;">Ediff</span> = <span style="color: #483d8b;">abs</span>(E0-E1)
    dE_conv.append(Ediff)
    <span style="color: #a020f0;">print</span>(f<span style="color: #8b2252;">"Iter : {cnt} E = {E1} Diff = {Ediff} E_bound={E_bound}"</span>)
    <span style="color: #a0522d;">E0</span> = E1

    <span style="color: #a0522d;">cnt</span> += 1
</pre>
</div>
</div>
</div>
<div id="outline-container-org2a1405b" class="outline-4">
<h4 id="org2a1405b"><span class="section-number-4">3.3.4</span> Main</h4>
<div class="outline-text-4" id="text-3-3-4">
<p>
/tmp/babel-DzBZdg/python-LzHa4M
</p>
</div>
</div>
</div>

<div id="outline-container-orgb6706d9" class="outline-3">
<h3 id="orgb6706d9"><span class="section-number-3">3.4</span> Figure</h3>
<div class="outline-text-3" id="text-3-4">

<div class="figure">
<p><img src="./Figs/Fig-5.png" alt="Fig-5.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-orgee47255" class="outline-3">
<h3 id="orgee47255"><span class="section-number-3">3.5</span> The local density Exchange potential</h3>
<div class="outline-text-3" id="text-3-5">
<p>
The Hartree potential used above is not the full potential since
we have substracted half of the electron density to take into
account the self-energy correction. However, if we take the
actual Hartree potential into account, the energy obtained is
very far from the exact energy.
</p>

<p>
In order to correct for this self interaction energy, we can use
the local density exchange potential (LDA). A simple functional
based on the electron gas is given as
</p>

<p>
\[
V_{\text{x}}(\mathbf{r}) = -\left( \frac{3}{\pi} \right )^{1/3} \times n^{1/3}(\mathbf{r})
\]
</p>


<p>
This potential is defined as the partial derivative of the exchange energy
</p>

<p>
\[
V_{\text{x}}[n](\mathbf{r}) = \frac{\partial}{\partial n (\mathbf{r})}E_{x}[n]
\]
</p>

<p>
And the exchange energy is given as
</p>

<p>
\[
E_{x}[n] = \int \text{d}^3 r \epsilon_{x}[n(\mathbf{r})]n(\mathbf{r})
\]
</p>

<p>
where the exchange energy density is given as
</p>

<p>
\[
\epsilon_{x}[n(\mathbf{r})] = -(3/4)(3/\pi)^{1/3} \times n^{1/3}(\mathbf{r})
\]
</p>

<p>
The local density exchange potential is derived from this local
energy density expression.
</p>

<p>
This local density based potential can correct for part of the self-energy error
in the Hartree potential. Note that here, and for the calculation for the
Hartree potential, the full density is to be taken. We can again
write this in terms of the radial function as
</p>

<p>
\[
V_{\text{x}}(\mathbf{r}) = -\left[ \frac{3u^2(r)}{2\pi^2r^2} \right ]^{1/3}
\]
</p>

<p>
and, using the above exchange energy, the total energy can then be
written as
</p>

<p>
\[
E = 2 \epsilon - \int \text{d}r\ V_H(r) u^2(r) + \frac{1}{2}\int \text{d}r\ V_{\text{x}}(r)u^2(r)
\]
</p>

<p>
The full equation the reads
</p>

\begin{align*}
\label{org72d8219}
y &= \begin{pmatrix} u \\ u' \end{pmatrix}\\
y' &= \begin{pmatrix} u' \\ u'' \end{pmatrix} = \begin{pmatrix} u' \\ 2\left( \frac{l(l+1)}{r^2} -\frac{\mathcal{Z}}{r} + V_H + V_{\text{x}} - E \right) u \end{pmatrix}\\
\end{align*}
</div>

<div id="outline-container-org1da8a83" class="outline-4">
<h4 id="org1da8a83"><span class="section-number-4">3.5.1</span> Vector Field</h4>
<div class="outline-text-4" id="text-3-5-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">vectorfieldX</span>(w, t, p):
    <span style="color: #8b2252;">"""</span>
<span style="color: #8b2252;">    Defines the differential equations for the coupled spring-mass system.</span>

<span style="color: #8b2252;">    Arguments:</span>
<span style="color: #8b2252;">    w :  vector of the state variables:</span>
<span style="color: #8b2252;">              w = [x1,y1,x2,y2]</span>
<span style="color: #8b2252;">    t :  time</span>
<span style="color: #8b2252;">    p :  vector of the parameters:</span>
<span style="color: #8b2252;">              p = [m1,m2,k1,k2,L1,L2,b1,b2]</span>
<span style="color: #8b2252;">    """</span>
    <span style="color: #a0522d;">x1</span>, <span style="color: #a0522d;">y1</span> = w
    <span style="color: #a0522d;">e1</span>, <span style="color: #a0522d;">l1</span>, <span style="color: #a0522d;">urf</span>, <span style="color: #a0522d;">tckur</span>, <span style="color: #a0522d;">uxrf</span>, <span style="color: #a0522d;">tckurx</span>, <span style="color: #a0522d;">nrf</span>, <span style="color: #a0522d;">tck</span>, <span style="color: #a0522d;">z</span> = p

    # <span style="color: #b22222;">Create f = (x1',y1'):</span>
    <span style="color: #a0522d;">f</span> = [y1,
         2*(l1*(l1+1)/(t)**2 - z/(t) - e1 + 2*urf(t,tckur)/t + uxrf(t,nrf,tck) )*x1
         ]

    <span style="color: #a020f0;">return</span> f
</pre>
</div>
</div>
</div>
<div id="outline-container-org800006f" class="outline-4">
<h4 id="org800006f"><span class="section-number-4">3.5.2</span> Calculate energy</h4>
<div class="outline-text-4" id="text-3-5-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">calcEnergyVx</span>(ei,urf,tckur,urxf,tckurx,nrf,tck,t=<span style="color: #008b8b;">None</span>,stoptime=60.0,numpoints=3200):
    <span style="color: #a0522d;">E</span> = 2*ei
    <span style="color: #a020f0;">if</span> t <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>:
        <span style="color: #a0522d;">t</span> = [stoptime * <span style="color: #483d8b;">float</span>(i+0.0001) / (numpoints - 1) <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(numpoints)]
    <span style="color: #a0522d;">VHl</span> = np.array([urf(x,tckur)/x <span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> t])
    <span style="color: #a0522d;">Vxl</span> = np.array([urxf(x,nrf,tck) <span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> t])
    <span style="color: #a0522d;">ur2</span> = np.array([(nrf(x,tck))**2 <span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> t])
    <span style="color: #a0522d;">eH</span> = integrate.simps(VHl*ur2, x=t)
    <span style="color: #a0522d;">ex</span> = integrate.simps(Vxl*ur2, x=t)
    <span style="color: #a020f0;">print</span>((eH, (ex/2)))
    <span style="color: #a0522d;">E</span> = E - eH + (ex/2)
    <span style="color: #a020f0;">return</span>(E)
</pre>
</div>
</div>
</div>
<div id="outline-container-org9a5e378" class="outline-4">
<h4 id="org9a5e378"><span class="section-number-4">3.5.3</span> SCF cycle code</h4>
<div class="outline-text-4" id="text-3-5-3">
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #a0522d;">stoptime</span>=60.0
<span style="color: #a0522d;">numpoints</span>=3200
<span style="color: #a0522d;">rr</span> = np.array([stoptime * <span style="color: #483d8b;">float</span>(i+0.0001) / (numpoints - 1) <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(numpoints)])

# <span style="color: #b22222;">Get initial density</span>
<span style="color: #a0522d;">E_bound</span>,<span style="color: #a0522d;">_</span>,<span style="color: #a0522d;">nrf</span>,<span style="color: #a0522d;">tck</span> = get_energy_and_density(0,rr,z=2.,E=-2.50,vectorfield=vectorfield)

# <span style="color: #b22222;">Get initial ur</span>
<span style="color: #a0522d;">qmax</span> = 1.
<span style="color: #a0522d;">xlim</span> = qmax
<span style="color: #a0522d;">ylim</span> = 0.
<span style="color: #a0522d;">x1</span>,<span style="color: #a0522d;">urf</span>,<span style="color: #a0522d;">tckur</span> = solve_SLP(fn=nrf, tckfn=tck, t=rr, xlim=xlim, ylim=ylim, vectorfield=vectorfieldVH, isWF=<span style="color: #008b8b;">False</span>)
<span style="color: #a0522d;">E0</span> = calcEnergy(E_bound, urf, tckur, nrf, tck)
<span style="color: #a020f0;">print</span>(E_bound, E0)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">urxf</span>(x,nrf,tck):
    <span style="color: #a0522d;">numer</span> = 3.*nrf(x,tck)*nrf(x,tck)
    <span style="color: #a0522d;">denom</span> = 2.*np.pi*np.pi*x*x
    <span style="color: #a020f0;">return</span>(-np.power(numer/denom,1/3))

<span style="color: #a0522d;">E_conv</span> = []
<span style="color: #a0522d;">dE_conv</span> = []
E_conv.append(E0)
dE_conv.append(E0)
<span style="color: #a0522d;">cnt</span> = 0
<span style="color: #a0522d;">Ediff</span> = 10.
<span style="color: #a020f0;">while</span> cnt &lt; 30 <span style="color: #a020f0;">and</span> <span style="color: #483d8b;">abs</span>(Ediff) &gt; 1.E-4:

    # <span style="color: #b22222;">Get density</span>
    <span style="color: #a0522d;">E_bound</span>,<span style="color: #a0522d;">_</span>,<span style="color: #a0522d;">nrf</span>,<span style="color: #a0522d;">tck</span> = get_energy_and_density(0,rr,z=2.,E=-1.00,vectorfield=vectorfieldX, urf=urf, tckur=tckur, fnx=urxf, tckfnx=tckur, fnc=nrf, tckfnc=tck)
    # <span style="color: #b22222;">Get ur</span>
    <span style="color: #a0522d;">x1</span>,<span style="color: #a0522d;">urf</span>,<span style="color: #a0522d;">tckur</span> = solve_SLP(fn=nrf, tckfn=tck, t=rr, xlim=xlim, ylim=ylim, vectorfield=vectorfieldVH, isWF=<span style="color: #008b8b;">False</span>)
    <span style="color: #a0522d;">E1</span> = calcEnergyVx(E_bound, urf, tckur, urxf, tckur, nrf, tck, t=rr)
    #<span style="color: #b22222;">E1 = E_bound</span>
    E_conv.append(E1)
    <span style="color: #a0522d;">Ediff</span> = <span style="color: #483d8b;">abs</span>(E0-E1)
    dE_conv.append(Ediff)
    <span style="color: #a020f0;">print</span>(f<span style="color: #8b2252;">"Iter : {cnt} E = {E1} Diff = {Ediff} E_bound={E_bound}"</span>)
    <span style="color: #a0522d;">E0</span> = E1

    <span style="color: #a0522d;">cnt</span> += 1
</pre>
</div>
</div>
</div>
<div id="outline-container-org4f89843" class="outline-4">
<h4 id="org4f89843"><span class="section-number-4">3.5.4</span> Main Shoot</h4>
<div class="outline-text-4" id="text-3-5-4">

<div class="figure">
<p><img src="file:///home/chilkuri/Documents/codes/python/gscf/Fig-tmp5.png" alt="Fig-tmp5.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org6227cc0" class="outline-4">
<h4 id="org6227cc0"><span class="section-number-4">3.5.5</span> Main</h4>
<div class="outline-text-4" id="text-3-5-5">

<div class="figure">
<p><img src="file:///home/chilkuri/Documents/codes/python/gscf/Figs/Fig-tmp6.png" alt="Fig-tmp6.png" />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgba1c1d0" class="outline-3">
<h3 id="orgba1c1d0"><span class="section-number-3">3.6</span> Figure</h3>
<div class="outline-text-3" id="text-3-6">

<div class="figure">
<p><img src="./Figs/Fig-6.png" alt="Fig-6.png" />
</p>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Vijay Gopal Chilkuri</p>
<p class="date">Created: 2023-05-31 Wed 11:49</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
